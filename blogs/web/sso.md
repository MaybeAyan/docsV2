---
title: 单点登录
date: 2023-09-06
tags:
  - web
categories:
  - 前端
---

## 前言
近期公司后台系统需要重新迭代登录页  
之前一直是 cv 其他项目的代码  
在和后端配合的时候  
发现自己对单点登录的理解不深
所以记录学习一下

## 单点登录
公司多个后台，采用统一登录方式，只需登录其中一个后台，就可以不必登录进入其他后台    
比如阿里的淘宝与天猫，登录了淘宝，天猫也会自动登录

## 优点
- 提升用户体验：只需登录一次就可以访问多个网站或者应用程序，减少不必要的频繁输入操作
- 提高安全性：用户的凭据只需在登录时输入一次，减少了凭据泄露的风险
- 简化管理：管理员只需管理一个身份验证系统，而不是多个应用程序的用户账户。

## 实现过程
1. 用户进入应用 ==> 未登录 ==> url 携带 referer 参数和 callback 参数跳转统一登录页面
2. 统一登录页面 ==> 用户输入账密 ==> 接口获取凭据
3. 接口凭据获取 token ==> 用户进入 session 页面 ==> 接口检验 token 合法性
4. 校验通过 ==> 跳回应用页面
5. 用户登出 ==> 本地清空登录状态 ==> 服务端遍历发过凭据的所有产品（应用）==> 调取对应api ==> 完成退出

补充：token 是在服务端产生的。如果前端使用用户名/密码向服务端请求认证，服务端认证成功，那么在服务端会返回 token 给前端。前端可以在每次请求的时候带上 token 证明自己的合法地位。如果这个 token 在服务端持久化（比如存入数据库），那它就是一个永久的身份令牌。

## Bug 隐患
公司旧版本的 SSO 统一登录在登出后，并没有在服务端清空 token，这样会带来一个严重的问题。  
如果我在 SSO 没有登录，而是直接在浏览器中敲入回调的地址，并带上伪造的用户信息，是不是业务系统也认为登录了呢？这是很可怕的。

## 小结
单点登录（SSO）的所有流程都介绍完了，原理大家都清楚了。总结一下单点登录要做的事情：
- 单点登录（SSO系统）是保障各业务系统的用户资源的安全 。
- 各个业务系统获得的信息是，这个用户能不能访问我的资源。
- 单点登录，资源都在各个业务系统这边，不在SSO那一方。       
用户在给SSO服务器提供了用户名密码后，作为业务系统并不知道这件事。 SSO随便给业务系统一个ST，那么业务系统是不能确定这个ST是用户伪造的，还是真的有效，所以要拿着这个ST去SSO服务器再问一下，这个用户给我的ST是否有效，是有效的我才能让这个用户访问。